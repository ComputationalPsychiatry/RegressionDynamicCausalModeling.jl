
function test_create_reg_ref(dcm)

    rdcm = RigidRdcm(dcm)
    X,Y = rDCM.create_regressors!(rdcm,MersenneTwister(1234))

    # values from Matlab implementation
    X_ref1 = [-3158.42013888784 + 0.00000000000000im,
    602.416324597881 - 319.236963772245im,
    37.8368296228979 - 609.760655376424im,
    553.443701350982 - 338.177871763967im,
    -220.295916252722 + 2.26278501224402im,
    -619.016640439999 + 188.872009404897im,
    -300.546854778430 - 370.505826191791im,
    256.149685569140 - 49.8572126224046im,
    220.657855265892 + 219.962076228386im,
    288.257636943430 - 647.354931734939im,
    -132.627088254651 - 68.6727787520354im,
    -405.352687081496 + 261.091062751771im,
    715.458794650565 - 487.759696057462im,
    -169.174704824149 + 340.638602019597im,
    107.936156323181 - 401.201416253234im,
    106.559005315980 - 178.180196953511im,
    377.453994667252 - 540.130275773803im,
    260.913637954161 + 29.6230834013906im,
    276.024859077699 + 341.165853210004im,
    -69.5808715045171 - 357.851772576171im]
    # X_ref2 = [169.625000000000 + 0.00000000000000im,
    # -6.92578780418806e-16 - 5.12573729906246e-17im,
    # -2.35948883183907e-15 - 1.98018553473672e-15im,
    # -2.02191247019898e-15 - 7.41623110961664e-16im,
    # 6.70535029390094e-15 - 1.12874047154407e-15im,
    # -3.15606409340235e-15 + 1.68513025940880e-15im,
    # 4.49170560701646e-15 - 3.93027119035241e-16im,
    # 2.92485316421304e-15 - 8.77048448125863e-16im,
    # -5.04166927728357e-15 + 4.91916044387704e-16im,
    # -4.93927904910991e-15 + 3.67487729097750e-15im,
    # -1.16021962486713e-15 - 1.95278484733853e-15im,
    # -1.15390258765371e-15 - 9.68424055572390e-15im,
    # -4.49879109453079e-16 + 2.86474228330057e-15im,
    # 9.33306784439553e-16 - 1.30015030760592e-15im,
    # 1.24407176094341e-15 - 3.68418771185382e-15im,
    # -2.29689732256083e-15 - 8.98411187561353e-16im,
    # -7.53888828075834e-16 + 3.64487275553657e-15im,
    # -2.75697920608763e-15 + 1.36318990461890e-15im,
    # -5.16753810386094e-15 - 8.46178811929111e-16im,
    # -3.78197332156322e-15 + 5.50157021449385e-15im]
    Y_ref = [0.00000000000000 + 0.00000000000000im,
    1.47490182231563 + 2.79101832092693im,
    5.64579973429614 + 0.363455643355507im,
    4.67076220499783 + 7.70392075901969im,
    -0.0230166491504791 - 4.08019487283422im,
    -4.28953838211415 - 14.3558502438601im,
    10.3507611403582 - 8.27780138795726im,
    1.54860248685902 + 8.31490515898904im,
    -8.22297450511170 + 8.09760848561084im,
    26.8493718769357 + 12.2923823689065im,
    3.25048584566129 - 6.10354984889681im,
    -13.0336468476766 - 20.8125999472523im,
    26.5454774885973 + 40.1239459492337im,
    -20.3476157162723 - 10.4900576600895im,
    25.8890851580619 + 7.41692853499336im,
    12.2441798728403 + 7.61421128681014im,
    39.4876156483990 + 28.6976412208634im,
    -2.73522362738389 + 20.4862320165619im,
    -28.9050384742562 + 22.4058993758015im,
    31.6060556293554 - 5.42704591506497im]

    @test all(X_ref1 .≈ X[1:20,1])
    #@test all(X_ref2 .≈ X[1:20,end]) # not passing at the moment, for some reason the last column differs from matlab -> after analysis: there are simply
    # numerical differences between matlab and julia such that it differs (but very small in the order of 1e-15)
    @test all(Y_ref .≈ Y[1:20,1])

    #deprecated
    # test different set of arguments
    #X,Y = rDCM.create_regressors!(dcm,rdcm.hrf)

    #@test all(X_ref1 .≈ X[1:20,1])
    #@test all(X_ref2 .≈ X[1:20,end]) # not passing at the moment, for some reason the last column differs from matlab -> after analysis: there are simply
    # numerical differences between matlab and julia such that it differs (but very small in the order of 1e-15)
    #@test all(Y_ref .≈ Y[1:20,1])
end

function test_reduce_zeros()
    #---------------------------------------------------------------
    X = [1.0 2.0 3.0; 4.0 5.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0]
    Y = [1.0 0.0; 0.0 1.0; 0.0 0.0; 0.0 0.0; 0.0 0.0]
    Y_ref = [1.0 0.0; 0.0 1.0;0.0 0.0;0.0 0.0;NaN NaN]

    rDCM.reduce_zeros!(X,Y,MersenneTwister(1234))

    @test isequal(Y,Y_ref)
end

function test_create_regressors()

    dcm = load_example_DCM()
    @testset "Create regressors" begin
        test_create_reg_ref(dcm)
        test_reduce_zeros()
    end
end

test_create_regressors()
